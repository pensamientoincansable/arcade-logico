<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcade L√≥gico - 15 Minijuegos Completos</title>
    <meta name="description" content="15 juegos de l√≥gica completos: Sudoku, Tres en Raya, Busca Minas, Memoria, Torres de Hanoi y m√°s">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --dark-bg: #0a0a1a;
            --card-bg: rgba(16, 16, 32, 0.85);
            --neon-blue: #0ff0fc;
            --neon-pink: #ff00ff;
            --neon-green: #00ff00;
            --neon-yellow: #ffff00;
            --text-primary: #ffffff;
            --text-secondary: #ccccff;
            --grid-color: rgba(0, 255, 255, 0.1);
            --shadow: 0 0 15px rgba(0, 255, 255, 0.3);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            user-select: none;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            line-height: 1.5;
        }

        #gridLines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -2;
        }

        #neonDots {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            pointer-events: none;
        }

        .neon-dot {
            position: absolute;
            border-radius: 50%;
            animation: pulse 4s infinite alternate;
        }

        @keyframes pulse {
            0% { opacity: 0.1; }
            100% { opacity: 0.4; }
        }

        .page {
            display: none;
            min-height: 100vh;
            padding: 1rem;
        }

        #mainPage {
            display: block;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0.5rem;
        }

        .header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
        }

        .logo {
            font-size: clamp(1.8rem, 6vw, 3rem);
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            margin-bottom: 1rem;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .game-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid rgba(0, 255, 255, 0.1);
            transition: var(--transition);
            cursor: pointer;
            backdrop-filter: blur(5px);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .game-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2);
        }

        .game-header {
            display: flex;
            align-items: start;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
        }

        .game-number {
            background: var(--neon-blue);
            color: var(--dark-bg);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            flex-shrink: 0;
        }

        .game-title {
            font-size: 1rem;
            color: var(--neon-blue);
            line-height: 1.2;
        }

        .game-desc {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .game-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }

        .game-difficulty {
            padding: 0.2rem 0.6rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .game-difficulty.easy {
            background: rgba(0, 255, 0, 0.15);
            color: var(--neon-green);
        }

        .game-difficulty.medium {
            background: rgba(255, 255, 0, 0.15);
            color: #ff0;
        }

        .game-difficulty.hard {
            background: rgba(255, 0, 0, 0.15);
            color: #ff6666;
        }

        .play-btn {
            background: rgba(255, 255, 255, 0.1);
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-weight: bold;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .play-btn:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin: 0.3rem;
            transition: var(--transition);
            font-size: 0.8rem;
        }

        .theme-toggle:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
        }

        .game-page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .back-button {
            background: none;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: var(--transition);
            font-size: 0.8rem;
            order: 1;
        }

        .back-button:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
        }

        .game-title-large {
            color: var(--neon-blue);
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            text-align: center;
            order: 2;
            flex-grow: 1;
        }

        .game-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 1rem;
            border: 1px solid rgba(0, 255, 255, 0.2);
            min-height: 300px;
            backdrop-filter: blur(5px);
            margin-top: 0.5rem;
        }

        .game-instructions {
            color: var(--text-secondary);
            text-align: center;
            font-size: 0.85rem;
            margin: 0.5rem auto 1rem;
            max-width: 600px;
        }

        .game-controls {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .game-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--neon-blue);
            border-radius: 8px;
            padding: 0.6rem 0.8rem;
            color: white;
            font-size: 0.9rem;
            width: 100%;
            max-width: 200px;
        }

        .game-button {
            background: rgba(255, 255, 255, 0.1);
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 0.6rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            font-size: 0.85rem;
        }

        .game-button:hover {
            background: var(--neon-blue);
            color: var(--dark-bg);
        }

        .game-board {
            margin: 1rem auto;
            display: grid;
            gap: 2px;
            justify-content: center;
        }

        .game-cell {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
        }

        .game-cell:hover {
            background: rgba(0, 255, 255, 0.1);
        }

        .game-feedback {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 0.8rem;
            margin: 1rem 0;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .game-stats {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background: rgba(0, 255, 255, 0.1);
            border-radius: 8px;
            padding: 0.6rem 1rem;
            text-align: center;
            min-width: 80px;
        }

        .stat-box h3 {
            color: var(--neon-blue);
            font-size: 0.75rem;
            margin-bottom: 0.3rem;
        }

        .stat-box p {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--neon-green);
        }

        @media (max-width: 480px) {
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0.3rem;
            }
            
            .game-container {
                padding: 0.8rem;
                min-height: 250px;
            }
            
            .stat-box {
                min-width: 70px;
                padding: 0.5rem;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .games-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 769px) {
            .games-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--neon-blue);
            border-radius: 4px;
        }

        .coming-soon {
            text-align: center;
            padding: 2rem 1rem;
        }

        .coming-soon-icon {
            font-size: 3rem;
            color: var(--neon-blue);
            margin-bottom: 1rem;
            opacity: 0.7;
        }

        .win { color: var(--neon-green) !important; }
        .lose { color: var(--neon-pink) !important; }
        .highlight { background: rgba(0, 255, 255, 0.2) !important; }
        .disabled { opacity: 0.5; pointer-events: none; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="gridLines"></div>
    <div id="neonDots"></div>
    
    <div id="mainPage" class="page">
        <div class="container">
            <header class="header">
                <h1 class="logo">ARCADE L√ìGICO</h1>
                <p class="subtitle">15 Minijuegos de L√≥gica - Ejercita tu Mente</p>
                <button id="themeToggle" class="theme-toggle">
                    <i class="fas fa-moon"></i> Tema
                </button>
            </header>
            
            <main>
                <div id="gamesGrid" class="games-grid"></div>
            </main>
        </div>
    </div>
    
    <div id="gamePage" class="page">
        <div class="container">
            <div class="game-page-header">
                <button id="backBtn" class="back-button">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
                <h2 id="currentGameTitle" class="game-title-large">Juego Actual</h2>
                <div style="width: 80px; order: 3;"></div>
            </div>
            
            <div id="gameContent"></div>
        </div>
    </div>
    
    <script>
        // ==================== CONFIGURACI√ìN ====================
        const domCache = {
            mainPage: null,
            gamePage: null,
            gamesGrid: null,
            gameContent: null,
            currentGameTitle: null,
            backBtn: null,
            themeToggle: null
        };

        const state = {
            currentGame: null,
            darkMode: true,
            gamesPlayed: 0,
            activeGameState: null
        };

        const games = [
            { id: 1, title: "Adivina el N√∫mero", difficulty: "easy", description: "Adivina el n√∫mero secreto entre 1 y 100", icon: "fa-bullseye" },
            { id: 2, title: "Tres en Raya", difficulty: "easy", description: "Alinea tres s√≠mbolos antes que tu oponente", icon: "fa-times" },
            { id: 3, title: "Sudoku", difficulty: "hard", description: "Completa la cuadr√≠cula 9x9 sin repetir n√∫meros", icon: "fa-th" },
            { id: 4, title: "Memorama", difficulty: "medium", description: "Encuentra todas las parejas de cartas", icon: "fa-brain" },
            { id: 5, title: "Torres de Hanoi", difficulty: "medium", description: "Mueve todos los discos siguiendo las reglas", icon: "fa-layer-group" },
            { id: 6, title: "Busca Minas", difficulty: "medium", description: "Encuentra minas usando pistas num√©ricas", icon: "fa-bomb" },
            { id: 7, title: "15 Puzzle", difficulty: "medium", description: "Ordena n√∫meros deslizando piezas", icon: "fa-puzzle-piece" },
            { id: 8, title: "Ahorcado", difficulty: "easy", description: "Adivina la palabra letra por letra", icon: "fa-user" },
            { id: 9, title: "Conecta 4", difficulty: "medium", description: "Conecta cuatro fichas en l√≠nea", icon: "fa-circle" },
            { id: 10, title: "Laberinto", difficulty: "hard", description: "Encuentra la salida del laberinto", icon: "fa-project-diagram" },
            { id: 11, title: "Criptograma", difficulty: "hard", description: "Descifra mensajes codificados", icon: "fa-key" },
            { id: 12, title: "Mastermind", difficulty: "medium", description: "Adivina combinaciones de colores", icon: "fa-user-secret" },
            { id: 13, title: "Juego de la Vida", difficulty: "medium", description: "Simula el aut√≥mata celular de Conway", icon: "fa-seedling" },
            { id: 14, title: "Battleship", difficulty: "medium", description: "Hunde la flota enemiga", icon: "fa-ship" },
            { id: 15, title: "Nonogramas", difficulty: "hard", description: "Resuelve rompecabezas l√≥gicos", icon: "fa-border-style" }
        ];

        // ==================== INICIALIZACI√ìN ====================
        document.addEventListener('DOMContentLoaded', function() {
            domCache.mainPage = document.getElementById('mainPage');
            domCache.gamePage = document.getElementById('gamePage');
            domCache.gamesGrid = document.getElementById('gamesGrid');
            domCache.gameContent = document.getElementById('gameContent');
            domCache.currentGameTitle = document.getElementById('currentGameTitle');
            domCache.backBtn = document.getElementById('backBtn');
            domCache.themeToggle = document.getElementById('themeToggle');
            
            createNeonDots();
            loadGamesGrid();
            setupEventListeners();
        });

        function createNeonDots() {
            const container = document.getElementById('neonDots');
            const dotCount = Math.min(20, Math.floor(window.innerWidth / 30));
            
            for (let i = 0; i < dotCount; i++) {
                const dot = document.createElement('div');
                dot.className = 'neon-dot';
                dot.style.left = Math.random() * 100 + '%';
                dot.style.top = Math.random() * 100 + '%';
                const size = 1 + Math.random() * 2;
                const duration = 3 + Math.random() * 4;
                dot.style.width = size + 'px';
                dot.style.height = size + 'px';
                dot.style.animationDuration = duration + 's';
                const colors = ['0ff0fc', 'ff00ff', '00ff00'];
                const color = colors[i % 3];
                dot.style.backgroundColor = '#' + color;
                container.appendChild(dot);
            }
        }

        function loadGamesGrid() {
            domCache.gamesGrid.innerHTML = games.map(game => `
                <div class="game-card" data-game-id="${game.id}">
                    <div class="game-header">
                        <div class="game-number">${game.id}</div>
                        <h3 class="game-title">${game.title}</h3>
                    </div>
                    <p class="game-desc">${game.description}</p>
                    <div class="game-footer">
                        <span class="game-difficulty ${game.difficulty}">
                            ${game.difficulty === 'easy' ? 'F√°cil' : game.difficulty === 'medium' ? 'Medio' : 'Dif√≠cil'}
                        </span>
                        <button class="play-btn" data-game-id="${game.id}">
                            <i class="fas ${game.icon}"></i> Jugar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function setupEventListeners() {
            domCache.gamesGrid.addEventListener('click', (e) => {
                const playBtn = e.target.closest('.play-btn');
                const gameCard = e.target.closest('.game-card');
                
                if (playBtn) {
                    const gameId = parseInt(playBtn.dataset.gameId);
                    launchGame(gameId);
                } else if (gameCard && !e.target.closest('.play-btn')) {
                    const gameId = parseInt(gameCard.dataset.gameId);
                    launchGame(gameId);
                }
            });
            
            domCache.backBtn.addEventListener('click', returnToMain);
            domCache.themeToggle.addEventListener('click', toggleTheme);
        }

        function launchGame(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;
            
            state.currentGame = game;
            state.gamesPlayed++;
            
            domCache.mainPage.style.display = 'none';
            domCache.gamePage.style.display = 'block';
            domCache.currentGameTitle.textContent = game.title;
            
            state.activeGameState = null;
            loadGameContent(game);
            window.scrollTo(0, 0);
        }

        // ==================== JUEGOS CORREGIDOS ====================

        const gameLoaders = {
            1: loadGuessNumberGame,
            2: loadTicTacToeGame,
            3: loadSudokuGame,
            4: loadMemoryGame,
            5: loadHanoiGame,
            6: loadMinesweeperGame,
            7: loadPuzzle15Game,
            8: loadHangmanGame,
            9: loadConnect4Game,
            10: loadMazeGame,
            11: loadCryptogramGame,
            12: loadMastermindGame,
            13: loadLifeGame,
            14: loadBattleshipGame,
            15: loadNonogramGame
        };

        function loadGameContent(game) {
            domCache.gameContent.innerHTML = '';
            const loader = gameLoaders[game.id];
            if (loader) {
                loader(domCache.gameContent);
            }
        }

        // JUEGO 1: Adivina el N√∫mero (CORREGIDO)
        function loadGuessNumberGame(container) {
            let secretNumber, attempts;
            
            function initGame() {
                secretNumber = Math.floor(Math.random() * 100) + 1;
                attempts = 0;
                updateDisplay();
            }
            
            function updateDisplay() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Adivina el N√∫mero</h2>
                        <p class="game-instructions">Adivina el n√∫mero entre 1 y 100</p>
                        <div class="game-controls">
                            <input type="number" id="guessInput" class="game-input" 
                                   placeholder="Tu n√∫mero" min="1" max="100">
                            <button id="guessBtn" class="game-button">Adivinar</button>
                        </div>
                        <div class="game-feedback" id="feedback">
                            Introduce un n√∫mero y haz clic en "Adivinar"
                        </div>
                        <div class="game-stats">
                            <div class="stat-box">
                                <h3>Intentos</h3>
                                <p id="attempts">${attempts}</p>
                            </div>
                            <div class="stat-box">
                                <h3>Rango</h3>
                                <p>1-100</p>
                            </div>
                        </div>
                        <div class="game-controls">
                            <button id="newGameBtn" class="game-button">Nuevo Juego</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('guessBtn').onclick = checkGuess;
                document.getElementById('newGameBtn').onclick = initGame;
                document.getElementById('guessInput').onkeypress = (e) => {
                    if (e.key === 'Enter') checkGuess();
                };
            }
            
            function checkGuess() {
                const input = document.getElementById('guessInput');
                const guess = parseInt(input.value);
                const feedback = document.getElementById('feedback');
                
                if (isNaN(guess) || guess < 1 || guess > 100) {
                    feedback.innerHTML = `<span class="lose">N√∫mero inv√°lido</span>`;
                    return;
                }
                
                attempts++;
                document.getElementById('attempts').textContent = attempts;
                
                if (guess === secretNumber) {
                    feedback.innerHTML = `<span class="win">¬°Correcto! El n√∫mero era ${secretNumber}</span>`;
                } else if (guess < secretNumber) {
                    feedback.innerHTML = `<span style="color:var(--neon-blue)">M√°s alto que ${guess}</span>`;
                } else {
                    feedback.innerHTML = `<span style="color:var(--neon-pink)">M√°s bajo que ${guess}</span>`;
                }
                
                input.value = '';
                input.focus();
            }
            
            initGame();
        }

        // JUEGO 2: Tres en Raya (CORREGIDO)
        function loadTicTacToeGame(container) {
            let board = ['','','','','','','','',''];
            let currentPlayer = 'X';
            let gameActive = true;
            
            const winPatterns = [
                [0,1,2], [3,4,5], [6,7,8],
                [0,3,6], [1,4,7], [2,5,8],
                [0,4,8], [2,4,6]
            ];
            
            function renderBoard() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Tres en Raya</h2>
                        <p class="game-instructions">Jugador: <span style="color:var(--neon-blue)">X</span> vs Computadora: <span style="color:var(--neon-pink)">O</span></p>
                        <div class="game-board" style="grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(3, 60px);">
                            ${board.map((cell, i) => `
                                <div class="game-cell" data-index="${i}" 
                                     style="font-size: 1.5rem; color: ${cell === 'X' ? 'var(--neon-blue)' : 'var(--neon-pink)'}">
                                    ${cell}
                                </div>
                            `).join('')}
                        </div>
                        <div class="game-feedback" id="feedback">
                            Turno del jugador X
                        </div>
                        <div class="game-controls">
                            <button id="resetBtn" class="game-button">Reiniciar</button>
                        </div>
                    </div>
                `;
                
                document.querySelectorAll('.game-cell').forEach(cell => {
                    cell.onclick = () => makeMove(parseInt(cell.dataset.index));
                });
                
                document.getElementById('resetBtn').onclick = resetGame;
            }
            
            function makeMove(index) {
                if (!gameActive || board[index] !== '') return;
                
                board[index] = currentPlayer;
                renderBoard();
                
                if (checkWinner()) {
                    document.getElementById('feedback').innerHTML = 
                        `<span class="win">¬°${currentPlayer} gana!</span>`;
                    gameActive = false;
                    return;
                }
                
                if (board.every(cell => cell !== '')) {
                    document.getElementById('feedback').innerHTML = `<span class="lose">¬°Empate!</span>`;
                    gameActive = false;
                    return;
                }
                
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                document.getElementById('feedback').textContent = `Turno del jugador ${currentPlayer}`;
                
                if (currentPlayer === 'O' && gameActive) {
                    setTimeout(computerMove, 500);
                }
            }
            
            function computerMove() {
                const emptyCells = board.map((cell, i) => cell === '' ? i : -1).filter(i => i !== -1);
                if (emptyCells.length > 0) {
                    const randomIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    makeMove(randomIndex);
                }
            }
            
            function checkWinner() {
                return winPatterns.some(pattern => {
                    const [a,b,c] = pattern;
                    return board[a] && board[a] === board[b] && board[a] === board[c];
                });
            }
            
            function resetGame() {
                board = ['','','','','','','','',''];
                currentPlayer = 'X';
                gameActive = true;
                renderBoard();
            }
            
            resetGame();
        }

        // JUEGO 3: Sudoku (CORREGIDO - versi√≥n 4x4 por simplicidad)
        function loadSudokuGame(container) {
            // Sudoku 4x4 simple
            const puzzle = [
                [1, 0, 0, 0],
                [0, 2, 0, 0],
                [0, 0, 3, 0],
                [0, 0, 0, 4]
            ];
            
            const solution = [
                [1, 3, 4, 2],
                [4, 2, 1, 3],
                [2, 4, 3, 1],
                [3, 1, 2, 4]
            ];
            
            let currentBoard = JSON.parse(JSON.stringify(puzzle));
            
            function renderBoard() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Sudoku 4x4</h2>
                        <p class="game-instructions">Completa los n√∫meros del 1 al 4 sin repetir en filas, columnas o cuadros 2x2</p>
                        <div class="game-board" style="
                            grid-template-columns: repeat(4, 50px);
                            grid-template-rows: repeat(4, 50px);
                            border: 2px solid var(--neon-blue);
                        ">
                            ${currentBoard.map((row, i) => 
                                row.map((cell, j) => `
                                    <div class="game-cell" data-row="${i}" data-col="${j}"
                                         style="font-size: 1.2rem;
                                                ${i % 2 === 1 ? 'border-bottom: 2px solid var(--neon-blue)' : ''};
                                                ${j % 2 === 1 ? 'border-right: 2px solid var(--neon-blue)' : ''};
                                                color: ${puzzle[i][j] ? 'var(--neon-blue)' : 'var(--neon-green)'};
                                                font-weight: ${puzzle[i][j] ? 'bold' : 'normal'}">
                                        ${cell || ''}
                                    </div>
                                `).join('')
                            ).join('')}
                        </div>
                        <div class="game-feedback" id="feedback">
                            Haz clic en una celda vac√≠a y usa el teclado num√©rico (1-4)
                        </div>
                        <div class="game-controls">
                            <button id="checkBtn" class="game-button">Comprobar</button>
                            <button id="resetBtn" class="game-button">Reiniciar</button>
                        </div>
                    </div>
                `;
                
                document.querySelectorAll('.game-cell').forEach(cell => {
                    const row = parseInt(cell.dataset.row);
                    const col = parseInt(cell.dataset.col);
                    if (!puzzle[row][col]) {
                        cell.onclick = () => selectCell(cell, row, col);
                    }
                });
                
                document.getElementById('checkBtn').onclick = checkSolution;
                document.getElementById('resetBtn').onclick = resetBoard;
                
                // Teclado num√©rico
                document.addEventListener('keydown', handleNumberInput);
            }
            
            let selectedCell = null;
            
            function selectCell(cell, row, col) {
                document.querySelectorAll('.game-cell').forEach(c => c.classList.remove('highlight'));
                cell.classList.add('highlight');
                selectedCell = { cell, row, col };
            }
            
            function handleNumberInput(e) {
                if (!selectedCell || !e.key.match(/^[1-4]$/)) return;
                
                const num = parseInt(e.key);
                const { cell, row, col } = selectedCell;
                
                currentBoard[row][col] = num;
                cell.textContent = num;
                cell.style.color = 'var(--neon-green)';
            }
            
            function checkSolution() {
                let correct = true;
                
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        if (currentBoard[i][j] !== solution[i][j]) {
                            correct = false;
                            break;
                        }
                    }
                }
                
                document.getElementById('feedback').innerHTML = correct ? 
                    '<span class="win">¬°Sudoku completado correctamente!</span>' :
                    '<span class="lose">A√∫n hay errores en el sudoku</span>';
            }
            
            function resetBoard() {
                currentBoard = JSON.parse(JSON.stringify(puzzle));
                renderBoard();
            }
            
            renderBoard();
        }

        // JUEGO 4: Memorama (CORREGIDO)
        function loadMemoryGame(container) {
            const symbols = ['üéÆ', 'üåü', 'üéØ', '‚ö°', 'üíé', 'üöÄ', 'üé™', 'üé®'];
            let cards = [...symbols, ...symbols];
            let flipped = [];
            let matched = [];
            let attempts = 0;
            let canFlip = true;
            
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            function renderBoard() {
                const shuffled = shuffle([...cards]);
                
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Memorama</h2>
                        <p class="game-instructions">Encuentra todas las parejas de cartas</p>
                        <div class="game-board" style="
                            grid-template-columns: repeat(4, 60px);
                            grid-template-rows: repeat(4, 60px);
                            gap: 5px;
                        ">
                            ${shuffled.map((symbol, i) => `
                                <div class="game-cell memory-card" data-index="${i}" data-symbol="${symbol}"
                                     style="font-size: 1.5rem; position: relative; cursor: pointer;">
                                    <div class="front" style="
                                        position: absolute; width: 100%; height: 100%;
                                        background: var(--neon-blue); display: none;
                                        align-items: center; justify-content: center;
                                        border-radius: 8px;">
                                        ${symbol}
                                    </div>
                                    <div class="back" style="
                                        position: absolute; width: 100%; height: 100%;
                                        background: rgba(255,255,255,0.1);
                                        display: flex; align-items: center;
                                        justify-content: center; border-radius: 8px;">
                                        ?
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="game-stats">
                            <div class="stat-box">
                                <h3>Pares</h3>
                                <p id="pairs">${matched.length / 2}/8</p>
                            </div>
                            <div class="stat-box">
                                <h3>Intentos</h3>
                                <p id="attempts">${attempts}</p>
                            </div>
                        </div>
                        <div class="game-controls">
                            <button id="resetBtn" class="game-button">Reiniciar</button>
                        </div>
                    </div>
                `;
                
                document.querySelectorAll('.memory-card').forEach(card => {
                    card.onclick = () => flipCard(card);
                });
                
                document.getElementById('resetBtn').onclick = resetGame;
                
                // Mostrar cartas volteadas
                flipped.forEach(card => {
                    card.querySelector('.front').style.display = 'flex';
                    card.querySelector('.back').style.display = 'none';
                });
                
                // Ocultar cartas emparejadas
                matched.forEach(card => {
                    card.style.opacity = '0.5';
                    card.style.cursor = 'default';
                });
            }
            
            function flipCard(card) {
                if (!canFlip || flipped.length >= 2 || 
                    card.classList.contains('flipped') || 
                    matched.includes(card)) return;
                
                card.classList.add('flipped');
                card.querySelector('.front').style.display = 'flex';
                card.querySelector('.back').style.display = 'none';
                flipped.push(card);
                
                if (flipped.length === 2) {
                    attempts++;
                    document.getElementById('attempts').textContent = attempts;
                    canFlip = false;
                    
                    const [card1, card2] = flipped;
                    
                    if (card1.dataset.symbol === card2.dataset.symbol) {
                        // Match encontrado
                        setTimeout(() => {
                            matched.push(card1, card2);
                            flipped = [];
                            canFlip = true;
                            
                            document.getElementById('pairs').textContent = `${matched.length / 2}/8`;
                            
                            if (matched.length === 16) {
                                setTimeout(() => {
                                    alert(`¬°Ganaste! Intentos: ${attempts}`);
                                }, 300);
                            }
                            
                            renderBoard();
                        }, 500);
                    } else {
                        // No es match
                        setTimeout(() => {
                            card1.classList.remove('flipped');
                            card2.classList.remove('flipped');
                            card1.querySelector('.front').style.display = 'none';
                            card1.querySelector('.back').style.display = 'flex';
                            card2.querySelector('.front').style.display = 'none';
                            card2.querySelector('.back').style.display = 'flex';
                            flipped = [];
                            canFlip = true;
                            renderBoard();
                        }, 1000);
                    }
                } else {
                    renderBoard();
                }
            }
            
            function resetGame() {
                flipped = [];
                matched = [];
                attempts = 0;
                canFlip = true;
                renderBoard();
            }
            
            resetGame();
        }

        // JUEGO 5: Torres de Hanoi (CORREGIDO)
        function loadHanoiGame(container) {
            let disks = 3;
            let towers = [[3,2,1], [], []];
            let selectedTower = null;
            let moves = 0;
            
            function renderGame() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Torres de Hanoi</h2>
                        <p class="game-instructions">Mueve todos los discos de la torre A a la C. No puedes poner un disco grande sobre uno peque√±o.</p>
                        <div style="display: flex; justify-content: center; gap: 40px; margin: 1rem 0;">
                            ${towers.map((tower, i) => `
                                <div style="text-align: center;">
                                    <div class="tower" data-tower="${i}" 
                                         style="width: 150px; height: 120px; 
                                                display: flex; flex-direction: column-reverse;
                                                align-items: center; justify-content: flex-start;
                                                padding-bottom: 10px; cursor: pointer;
                                                border-bottom: 3px solid var(--neon-blue);
                                                position: relative;">
                                        ${tower.map(disk => `
                                            <div style="
                                                width: ${disk * 30 + 40}px;
                                                height: 20px;
                                                background: ${disk === 3 ? 'var(--neon-blue)' : 
                                                            disk === 2 ? 'var(--neon-pink)' : 'var(--neon-green)'};
                                                border-radius: 10px;
                                                margin: 2px 0;
                                            "></div>
                                        `).join('')}
                                    </div>
                                    <div style="margin-top: 5px; color: var(--neon-blue); font-weight: bold;">
                                        ${String.fromCharCode(65 + i)}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="game-stats">
                            <div class="stat-box">
                                <h3>Movimientos</h3>
                                <p>${moves}</p>
                            </div>
                            <div class="stat-box">
                                <h3>Discos</h3>
                                <p>${disks}</p>
                            </div>
                        </div>
                        <div class="game-feedback" id="feedback">
                            ${selectedTower === null ? 'Selecciona una torre' : 'Selecciona la torre destino'}
                        </div>
                        <div class="game-controls">
                            <button id="resetBtn" class="game-button">Reiniciar</button>
                            <button id="hintBtn" class="game-button">Ayuda</button>
                        </div>
                    </div>
                `;
                
                document.querySelectorAll('.tower').forEach(tower => {
                    tower.onclick = () => handleTowerClick(parseInt(tower.dataset.tower));
                });
                
                document.getElementById('resetBtn').onclick = resetGame;
                document.getElementById('hintBtn').onclick = () => {
                    alert("Instrucciones:\n1. Solo puedes mover un disco a la vez\n2. Solo puedes mover el disco superior de una torre\n3. No puedes colocar un disco grande sobre uno peque√±o\n4. Objetivo: Mover todos los discos a la torre C");
                };
                
                // Resaltar torre seleccionada
                if (selectedTower !== null) {
                    const towers = document.querySelectorAll('.tower');
                    towers[selectedTower].style.border = '2px solid var(--neon-green)';
                }
            }
            
            function handleTowerClick(towerIndex) {
                if (selectedTower === null) {
                    // Seleccionar torre origen
                    if (towers[towerIndex].length > 0) {
                        selectedTower = towerIndex;
                        document.getElementById('feedback').textContent = 'Ahora selecciona la torre destino';
                    } else {
                        document.getElementById('feedback').innerHTML = '<span class="lose">Esta torre est√° vac√≠a</span>';
                    }
                } else {
                    // Mover disco
                    if (selectedTower === towerIndex) {
                        selectedTower = null;
                        document.getElementById('feedback').textContent = 'Selecciona una torre';
                    } else {
                        const fromTower = towers[selectedTower];
                        const toTower = towers[towerIndex];
                        
                        if (fromTower.length === 0) {
                            document.getElementById('feedback').innerHTML = '<span class="lose">Torre origen vac√≠a</span>';
                            selectedTower = null;
                            return;
                        }
                        
                        const disk = fromTower[fromTower.length - 1];
                        
                        if (toTower.length === 0 || toTower[toTower.length - 1] > disk) {
                            // Movimiento v√°lido
                            fromTower.pop();
                            toTower.push(disk);
                            moves++;
                            selectedTower = null;
                            
                            // Verificar victoria
                            if (towers[2].length === disks) {
                                document.getElementById('feedback').innerHTML = 
                                    `<span class="win">¬°Ganaste! Movimientos: ${moves}</span>`;
                            } else {
                                document.getElementById('feedback').textContent = 'Movimiento realizado';
                            }
                        } else {
                            document.getElementById('feedback').innerHTML = 
                                '<span class="lose">No puedes poner un disco grande sobre uno peque√±o</span>';
                            selectedTower = null;
                        }
                    }
                }
                
                renderGame();
            }
            
            function resetGame() {
                disks = 3;
                towers = [[3,2,1], [], []];
                selectedTower = null;
                moves = 0;
                renderGame();
            }
            
            resetGame();
        }

        // JUEGO 6: Busca Minas (CORREGIDO - sin bucles infinitos)
        function loadMinesweeperGame(container) {
            const size = 8;
            const mines = 10;
            let board = [];
            let revealed = 0;
            let gameOver = false;
            
            function initBoard() {
                board = Array(size).fill().map(() => 
                    Array(size).fill().map(() => ({
                        mine: false,
                        revealed: false,
                        flagged: false,
                        count: 0
                    }))
                );
                
                // Colocar minas
                let placed = 0;
                while (placed < mines) {
                    const x = Math.floor(Math.random() * size);
                    const y = Math.floor(Math.random() * size);
                    
                    if (!board[y][x].mine) {
                        board[y][x].mine = true;
                        placed++;
                        
                        // Actualizar contadores
                        for (let dy = -1; dy <= 1; dy++) {
                            for (let dx = -1; dx <= 1; dx++) {
                                const ny = y + dy;
                                const nx = x + dx;
                                if (ny >= 0 && ny < size && nx >= 0 && nx < size) {
                                    board[ny][nx].count++;
                                }
                            }
                        }
                    }
                }
                
                revealed = 0;
                gameOver = false;
            }
            
            function renderBoard() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Busca Minas</h2>
                        <p class="game-instructions">Haz clic para revelar, clic derecho para marcar/desmarcar bandera</p>
                        <div class="game-board" style="
                            grid-template-columns: repeat(${size}, 35px);
                            grid-template-rows: repeat(${size}, 35px);
                        ">
                            ${board.map((row, y) => 
                                row.map((cell, x) => `
                                    <div class="game-cell" data-x="${x}" data-y="${y}"
                                         style="font-size: 0.8rem; font-weight: bold;
                                                ${cell.revealed ? 
                                                    cell.mine ? 
                                                        'background: var(--neon-pink)' : 
                                                        'background: rgba(255,255,255,0.1)' 
                                                    : 'background: rgba(0,255,255,0.1)'};
                                                color: ${getNumberColor(cell.count)};
                                                cursor: ${gameOver ? 'default' : 'pointer'};">
                                        ${cell.flagged ? 'üö©' : 
                                          cell.revealed && cell.mine ? 'üí£' :
                                          cell.revealed && cell.count > 0 ? cell.count : ''}
                                    </div>
                                `).join('')
                            ).join('')}
                        </div>
                        <div class="game-stats">
                            <div class="stat-box">
                                <h3>Minas</h3>
                                <p>${mines}</p>
                            </div>
                            <div class="stat-box">
                                <h3>Reveladas</h3>
                                <p>${revealed}/${size*size - mines}</p>
                            </div>
                        </div>
                        <div class="game-feedback" id="feedback">
                            ${gameOver ? 
                                (board.some(row => row.some(cell => cell.revealed && cell.mine)) ? 
                                    '<span class="lose">¬°Boom! Has perdido</span>' : 
                                    '<span class="win">¬°Ganaste! Has encontrado todas las minas</span>') : 
                                'En curso...'}
                        </div>
                        <div class="game-controls">
                            <button id="resetBtn" class="game-button">Nuevo Juego</button>
                        </div>
                    </div>
                `;
                
                if (!gameOver) {
                    document.querySelectorAll('.game-cell').forEach(cell => {
                        const x = parseInt(cell.dataset.x);
                        const y = parseInt(cell.dataset.y);
                        
                        cell.onclick = () => revealCell(x, y);
                        cell.oncontextmenu = (e) => {
                            e.preventDefault();
                            toggleFlag(x, y);
                            return false;
                        };
                    });
                }
                
                document.getElementById('resetBtn').onclick = () => {
                    initBoard();
                    renderBoard();
                };
            }
            
            function getNumberColor(count) {
                switch(count) {
                    case 1: return '#0000ff';
                    case 2: return '#008000';
                    case 3: return '#ff0000';
                    case 4: return '#000080';
                    case 5: return '#800000';
                    case 6: return '#008080';
                    case 7: return '#000000';
                    case 8: return '#808080';
                    default: return 'var(--text-primary)';
                }
            }
            
            function revealCell(x, y) {
                if (gameOver || board[y][x].revealed || board[y][x].flagged) return;
                
                board[y][x].revealed = true;
                revealed++;
                
                if (board[y][x].mine) {
                    gameOver = true;
                    // Mostrar todas las minas
                    board.forEach(row => row.forEach(cell => {
                        if (cell.mine) cell.revealed = true;
                    }));
                } else if (board[y][x].count === 0) {
                    // Revelar celdas adyacentes autom√°ticamente (sin recursi√≥n)
                    const stack = [[x, y]];
                    const visited = new Set();
                    
                    while (stack.length > 0) {
                        const [cx, cy] = stack.pop();
                        const key = `${cx},${cy}`;
                        
                        if (visited.has(key)) continue;
                        visited.add(key);
                        
                        // Revelar celdas adyacentes
                        for (let dy = -1; dy <= 1; dy++) {
                            for (let dx = -1; dx <= 1; dx++) {
                                const nx = cx + dx;
                                const ny = cy + dy;
                                
                                if (nx >= 0 && nx < size && ny >= 0 && ny < size) {
                                    const cell = board[ny][nx];
                                    if (!cell.revealed && !cell.flagged && !cell.mine) {
                                        cell.revealed = true;
                                        revealed++;
                                        
                                        if (cell.count === 0) {
                                            stack.push([nx, ny]);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                
                // Verificar victoria
                if (revealed === size*size - mines) {
                    gameOver = true;
                }
                
                renderBoard();
            }
            
            function toggleFlag(x, y) {
                if (gameOver || board[y][x].revealed) return;
                board[y][x].flagged = !board[y][x].flagged;
                renderBoard();
            }
            
            initBoard();
            renderBoard();
        }

        // JUEGO 7: 15 Puzzle (CORREGIDO)
        function loadPuzzle15Game(container) {
            let board = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0];
            let emptyIndex = 15;
            let moves = 0;
            
            function shuffleBoard() {
                // Mezcla simple (100 movimientos aleatorios)
                for (let i = 0; i < 100; i++) {
                    const possibleMoves = getPossibleMoves(emptyIndex);
                    const move = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    swapTiles(emptyIndex, move);
                }
                moves = 0;
            }
            
            function getPossibleMoves(index) {
                const moves = [];
                const row = Math.floor(index / 4);
                const col = index % 4;
                
                if (row > 0) moves.push(index - 4);
                if (row < 3) moves.push(index + 4);
                if (col > 0) moves.push(index - 1);
                if (col < 3) moves.push(index + 1);
                
                return moves;
            }
            
            function swapTiles(i, j) {
                [board[i], board[j]] = [board[j], board[i]];
                emptyIndex = board[i] === 0 ? i : j;
            }
            
            function renderBoard() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">15 Puzzle</h2>
                        <p class="game-instructions">Ordena los n√∫meros del 1 al 15. Haz clic en un n√∫mero adyacente al espacio vac√≠o.</p>
                        <div class="game-board" style="
                            grid-template-columns: repeat(4, 60px);
                            grid-template-rows: repeat(4, 60px);
                            gap: 2px;
                        ">
                            ${board.map((num, i) => `
                                <div class="game-cell" data-index="${i}"
                                     style="font-size: 1.2rem; font-weight: bold;
                                            ${num === 0 ? 'visibility: hidden; background: transparent' : 'background: rgba(0,255,255,0.2)'};
                                            color: var(--neon-blue);
                                            cursor: ${num !== 0 ? 'pointer' : 'default'}">
                                    ${num || ''}
                                </div>
                            `).join('')}
                        </div>
                        <div class="game-stats">
                            <div class="stat-box">
                                <h3>Movimientos</h3>
                                <p>${moves}</p>
                            </div>
                            <div class="stat-box">
                                <h3>Completado</h3>
                                <p>${isSolved() ? '100%' : '0%'}</p>
                            </div>
                        </div>
                        <div class="game-feedback" id="feedback">
                            ${isSolved() ? '<span class="win">¬°Puzzle completado!</span>' : 'Haz clic en un n√∫mero para moverlo'}
                        </div>
                        <div class="game-controls">
                            <button id="shuffleBtn" class="game-button">Mezclar</button>
                            <button id="solveBtn" class="game-button">Resolver</button>
                        </div>
                    </div>
                `;
                
                document.querySelectorAll('.game-cell').forEach(cell => {
                    const index = parseInt(cell.dataset.index);
                    if (board[index] !== 0) {
                        cell.onclick = () => handleClick(index);
                    }
                });
                
                document.getElementById('shuffleBtn').onclick = () => {
                    shuffleBoard();
                    renderBoard();
                };
                
                document.getElementById('solveBtn').onclick = () => {
                    board = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0];
                    emptyIndex = 15;
                    moves = 0;
                    renderBoard();
                };
            }
            
            function handleClick(index) {
                const possibleMoves = getPossibleMoves(emptyIndex);
                
                if (possibleMoves.includes(index)) {
                    swapTiles(emptyIndex, index);
                    moves++;
                    
                    if (isSolved()) {
                        document.getElementById('feedback').innerHTML = 
                            `<span class="win">¬°Ganaste! Movimientos: ${moves}</span>`;
                    }
                    
                    renderBoard();
                }
            }
            
            function isSolved() {
                for (let i = 0; i < 15; i++) {
                    if (board[i] !== i + 1) return false;
                }
                return board[15] === 0;
            }
            
            shuffleBoard();
            renderBoard();
        }

        // JUEGO 8: Ahorcado (CORREGIDO)
        function loadHangmanGame(container) {
            const words = ['LOGICA', 'JUEGO', 'COMPUTADORA', 'PROGRAMACION', 'ALGORITMO', 'INTERNET'];
            let word = '';
            let guessed = [];
            let wrong = 0;
            const maxWrong = 6;
            
            function initGame() {
                word = words[Math.floor(Math.random() * words.length)];
                guessed = Array(word.length).fill('_');
                wrong = 0;
                renderGame();
            }
            
            function renderGame() {
                const hangmanParts = ['Cabeza', 'Cuerpo', 'Brazo Izq', 'Brazo Der', 'Pierna Izq', 'Pierna Der'];
                const displayWord = guessed.join(' ');
                
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Ahorcado</h2>
                        <p class="game-instructions">Adivina la palabra letra por letra</p>
                        <div style="margin: 1rem 0; text-align: center;">
                            <div style="font-size: 2rem; letter-spacing: 10px; margin: 1rem 0; color: var(--neon-blue)">
                                ${displayWord}
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin: 0.5rem 0;">
                                Errores: ${wrong}/${maxWrong}
                            </div>
                            <div style="color: var(--neon-pink); min-height: 20px;">
                                ${wrong > 0 ? `Partes del ahorcado: ${hangmanParts.slice(0, wrong).join(', ')}` : ''}
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(9, 1fr); gap: 5px; margin: 1rem 0;">
                            ${'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('').map(letter => {
                                const isGuessed = guessed.includes(letter) || word.includes(letter);
                                return `
                                    <button class="game-button" style="padding: 0.3rem; font-size: 0.8rem;"
                                            data-letter="${letter}"
                                            ${isGuessed ? 'disabled' : ''}
                                            onclick="this._gameData.guessLetter('${letter}')">
                                        ${letter}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                        <div class="game-feedback" id="feedback">
                            ${wrong >= maxWrong ? 
                                `<span class="lose">¬°Perdiste! La palabra era: ${word}</span>` :
                                guessed.includes('_') ? 
                                'Haz clic en una letra para adivinar' :
                                `<span class="win">¬°Ganaste! La palabra es: ${word}</span>`}
                        </div>
                        <div class="game-controls">
                            <button id="newGameBtn" class="game-button">Nueva Palabra</button>
                        </div>
                    </div>
                `;
                
                // Asignar funci√≥n de juego al contexto global
                window.tempHangmanGame = {
                    guessLetter: function(letter) {
                        if (word.includes(letter)) {
                            // Actualizar letras adivinadas
                            for (let i = 0; i < word.length; i++) {
                                if (word[i] === letter) {
                                    guessed[i] = letter;
                                }
                            }
                        } else {
                            wrong++;
                        }
                        
                        renderGame();
                    }
                };
                
                document.querySelectorAll('[onclick*="guessLetter"]').forEach(btn => {
                    btn._gameData = window.tempHangmanGame;
                });
                
                document.getElementById('newGameBtn').onclick = initGame;
            }
            
            initGame();
        }

        // JUEGO 9: Conecta 4 (CORREGIDO)
        function loadConnect4Game(container) {
            const rows = 6;
            const cols = 7;
            let board = Array(rows).fill().map(() => Array(cols).fill(0));
            let currentPlayer = 1;
            let gameOver = false;
            
            function renderBoard() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Conecta 4</h2>
                        <p class="game-instructions">
                            Jugador 1: <span style="color:var(--neon-blue)">‚óè</span> vs 
                            Jugador 2: <span style="color:var(--neon-pink)">‚óè</span>
                        </p>
                        <div style="margin: 1rem auto; max-width: ${cols * 50}px;">
                            <!-- Encabezados de columnas -->
                            <div style="display: flex; margin-bottom: 5px;">
                                ${Array(cols).fill().map((_, col) => `
                                    <div style="width: 40px; text-align: center; color: var(--neon-blue); cursor: pointer;"
                                         onclick="this._gameData.makeMove(${col})">
                                        ${String.fromCharCode(65 + col)}
                                    </div>
                                `).join('')}
                            </div>
                            
                            <!-- Tablero -->
                            ${board.map((row, y) => `
                                <div style="display: flex;">
                                    ${row.map((cell, x) => `
                                        <div style="width: 40px; height: 40px; margin: 2px;
                                                    background: rgba(255,255,255,0.1);
                                                    border-radius: 50%;
                                                    display: flex; align-items: center;
                                                    justify-content: center;">
                                            ${cell === 1 ? 
                                                '<div style="width: 30px; height: 30px; background: var(--neon-blue); border-radius: 50%;"></div>' : 
                                              cell === 2 ? 
                                                '<div style="width: 30px; height: 30px; background: var(--neon-pink); border-radius: 50%;"></div>' : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            `).join('')}
                        </div>
                        <div class="game-feedback" id="feedback" style="color: ${currentPlayer === 1 ? 'var(--neon-blue)' : 'var(--neon-pink)'}">
                            ${gameOver ? 
                                (board.flat().includes(0) ? 
                                    `¬°Jugador ${currentPlayer === 1 ? 2 : 1} gana!` : 
                                    '¬°Empate!') : 
                                `Turno del Jugador ${currentPlayer}`}
                        </div>
                        <div class="game-controls">
                            <button id="resetBtn" class="game-button">Reiniciar</button>
                        </div>
                    </div>
                `;
                
                // Asignar funci√≥n de juego
                window.tempConnect4Game = {
                    makeMove: function(col) {
                        if (gameOver) return;
                        
                        // Encontrar la fila m√°s baja disponible
                        for (let row = rows - 1; row >= 0; row--) {
                            if (board[row][col] === 0) {
                                board[row][col] = currentPlayer;
                                
                                if (checkWin(row, col)) {
                                    gameOver = true;
                                } else if (board.every(row => row.every(cell => cell !== 0))) {
                                    gameOver = true;
                                } else {
                                    currentPlayer = currentPlayer === 1 ? 2 : 1;
                                }
                                
                                renderBoard();
                                return;
                            }
                        }
                    }
                };
                
                document.querySelectorAll('[onclick*="makeMove"]').forEach(el => {
                    el._gameData = window.tempConnect4Game;
                });
                
                document.getElementById('resetBtn').onclick = resetGame;
            }
            
            function checkWin(row, col) {
                const player = board[row][col];
                const directions = [
                    [[0,1],[0,-1]],   // Horizontal
                    [[1,0],[-1,0]],   // Vertical
                    [[1,1],[-1,-1]],  // Diagonal \
                    [[1,-1],[-1,1]]   // Diagonal /
                ];
                
                for (const [dir1, dir2] of directions) {
                    let count = 1;
                    
                    // Contar en una direcci√≥n
                    let [r, c] = [row + dir1[0], col + dir1[1]];
                    while (r >= 0 && r < rows && c >= 0 && c < cols && board[r][c] === player) {
                        count++;
                        r += dir1[0];
                        c += dir1[1];
                    }
                    
                    // Contar en la direcci√≥n opuesta
                    [r, c] = [row + dir2[0], col + dir2[1]];
                    while (r >= 0 && r < rows && c >= 0 && c < cols && board[r][c] === player) {
                        count++;
                        r += dir2[0];
                        c += dir2[1];
                    }
                    
                    if (count >= 4) return true;
                }
                
                return false;
            }
            
            function resetGame() {
                board = Array(rows).fill().map(() => Array(cols).fill(0));
                currentPlayer = 1;
                gameOver = false;
                renderBoard();
            }
            
            resetGame();
        }

        // JUEGO 10: Laberinto (CORREGIDO - con salida)
        function loadMazeGame(container) {
            const size = 15;
            let maze = [];
            let playerPos = {x: 1, y: 1};
            let exitPos = {x: size-2, y: size-2};
            
            function generateMaze() {
                // Inicializar laberinto con paredes
                maze = Array(size).fill().map(() => Array(size).fill(1));
                
                // Funci√≥n recursiva para generar laberinto
                function carve(x, y) {
                    maze[y][x] = 0;
                    
                    const directions = [[0,2],[2,0],[0,-2],[-2,0]];
                    directions.sort(() => Math.random() - 0.5);
                    
                    for (const [dx, dy] of directions) {
                        const nx = x + dx;
                        const ny = y + dy;
                        
                        if (nx > 0 && nx < size-1 && ny > 0 && ny < size-1 && maze[ny][nx] === 1) {
                            maze[y + dy/2][x + dx/2] = 0;
                            carve(nx, ny);
                        }
                    }
                }
                
                // Generar laberinto desde el centro
                carve(1, 1);
                
                // Asegurar que la salida sea accesible
                maze[exitPos.y][exitPos.x] = 2; // Salida
                maze[playerPos.y][playerPos.x] = 0; // Jugador
                
                // Crear camino a la salida si est√° bloqueada
                if (maze[exitPos.y-1][exitPos.x] === 1 && maze[exitPos.y][exitPos.x-1] === 1) {
                    maze[exitPos.y-1][exitPos.x] = 0;
                }
            }
            
            function renderMaze() {
                const cellSize = Math.min(25, Math.floor(400 / size));
                
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Laberinto</h2>
                        <p class="game-instructions">Usa las flechas del teclado para moverte hacia la salida (‚òÖ)</p>
                        <div class="game-board" style="
                            grid-template-columns: repeat(${size}, ${cellSize}px);
                            grid-template-rows: repeat(${size}, ${cellSize}px);
                        ">
                            ${maze.map((row, y) => 
                                row.map((cell, x) => `
                                    <div class="game-cell" 
                                         style="background: ${cell === 1 ? 'rgba(255,255,255,0.2)' : 
                                                   cell === 2 ? 'var(--neon-green)' :
                                                   x === playerPos.x && y === playerPos.y ? 'var(--neon-blue)' :
                                                   'rgba(0,255,255,0.05)'};
                                                font-size: 0.8rem;
                                                display: flex;
                                                align-items: center;
                                                justify-content: center;">
                                        ${cell === 2 ? '‚òÖ' : 
                                         x === playerPos.x && y === playerPos.y ? '‚óè' : ''}
                                    </div>
                                `).join('')
                            ).join('')}
                        </div>
                        <div class="game-feedback" id="feedback">
                            ${playerPos.x === exitPos.x && playerPos.y === exitPos.y ? 
                                '<span class="win">¬°Encontraste la salida!</span>' :
                                'Usa las teclas de flecha para moverte'}
                        </div>
                        <div class="game-controls">
                            <button class="game-button" onclick="movePlayer('up')">‚Üë</button>
                            <button class="game-button" onclick="movePlayer('left')">‚Üê</button>
                            <button class="game-button" onclick="movePlayer('down')">‚Üì</button>
                            <button class="game-button" onclick="movePlayer('right')">‚Üí</button>
                            <button id="newMazeBtn" class="game-button">Nuevo Laberinto</button>
                        </div>
                    </div>
                `;
                
                // Asignar funci√≥n de movimiento
                window.movePlayer = function(direction) {
                    if (playerPos.x === exitPos.x && playerPos.y === exitPos.y) return;
                    
                    let newPos = {...playerPos};
                    
                    switch(direction) {
                        case 'up': newPos.y--; break;
                        case 'down': newPos.y++; break;
                        case 'left': newPos.x--; break;
                        case 'right': newPos.x++; break;
                    }
                    
                    if (newPos.x >= 0 && newPos.x < size && 
                        newPos.y >= 0 && newPos.y < size &&
                        maze[newPos.y][newPos.x] !== 1) {
                        
                        playerPos = newPos;
                        
                        if (playerPos.x === exitPos.x && playerPos.y === exitPos.y) {
                            document.getElementById('feedback').innerHTML = 
                                '<span class="win">¬°Encontraste la salida!</span>';
                        }
                        
                        renderMaze();
                    }
                };
                
                document.getElementById('newMazeBtn').onclick = () => {
                    generateMaze();
                    playerPos = {x: 1, y: 1};
                    renderMaze();
                };
                
                // Controles del teclado
                document.addEventListener('keydown', handleKeyPress);
            }
            
            function handleKeyPress(e) {
                switch(e.key) {
                    case 'ArrowUp': movePlayer('up'); break;
                    case 'ArrowDown': movePlayer('down'); break;
                    case 'ArrowLeft': movePlayer('left'); break;
                    case 'ArrowRight': movePlayer('right'); break;
                }
            }
            
            generateMaze();
            renderMaze();
        }

        // JUEGO 11: Criptograma (simplificado)
        function loadCryptogramGame(container) {
            const quotes = [
                "EL JUEGO ES DIVERTIDO",
                "LOGICA Y MATEMATICA",
                "PROGRAMAR ES CREAR",
                "COMPUTADORA ELECTRONICA"
            ];
            
            let quote = '';
            let encoded = '';
            let solution = '';
            
            function initGame() {
                quote = quotes[Math.floor(Math.random() * quotes.length)].toUpperCase();
                solution = quote;
                
                // Crear cifrado simple
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                const shuffled = alphabet.split('').sort(() => Math.random() - 0.5);
                
                encoded = '';
                for (let char of quote) {
                    if (char >= 'A' && char <= 'Z') {
                        const index = alphabet.indexOf(char);
                        encoded += shuffled[index];
                    } else {
                        encoded += char;
                    }
                }
                
                renderGame();
            }
            
            function renderGame() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Criptograma</h2>
                        <p class="game-instructions">Descifra el mensaje codificado</p>
                        
                        <div style="margin: 1rem 0; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px;">
                            <div style="font-size: 1.2rem; letter-spacing: 3px; line-height: 1.8; text-align: center;">
                                ${encoded.split('').map(char => char === ' ' ? '&nbsp;&nbsp;' : char).join(' ')}
                            </div>
                        </div>
                        
                        <div class="game-feedback" id="feedback">
                            Intenta descifrar el mensaje
                        </div>
                        
                        <div class="game-controls">
                            <button id="showBtn" class="game-button">Mostrar Soluci√≥n</button>
                            <button id="newBtn" class="game-button">Nuevo Mensaje</button>
                        </div>
                    </div>
                `;
                
                document.getElementById('showBtn').onclick = () => {
                    document.getElementById('feedback').innerHTML = 
                        `<span class="win">Soluci√≥n: ${solution}</span>`;
                };
                
                document.getElementById('newBtn').onclick = initGame;
            }
            
            initGame();
        }

        // JUEGO 12: Mastermind (simplificado)
        function loadMastermindGame(container) {
            const colors = ['R', 'G', 'B', 'Y'];
            const codeLength = 4;
            let secretCode = [];
            let attempts = [];
            const maxAttempts = 8;
            
            function generateCode() {
                secretCode = [];
                for (let i = 0; i < codeLength; i++) {
                    secretCode.push(colors[Math.floor(Math.random() * colors.length)]);
                }
                attempts = [];
            }
            
            function renderGame() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Mastermind</h2>
                        <p class="game-instructions">Adivina el c√≥digo de 4 colores (R=Rojo, G=Verde, B=Azul, Y=Amarillo)</p>
                        
                        <div style="margin: 1rem 0;">
                            ${Array(maxAttempts).fill().map((_, i) => {
                                const attempt = attempts[i] || {guess: [], feedback: []};
                                return `
                                    <div style="display: flex; align-items: center; gap: 10px; margin: 5px 0;">
                                        <div style="display: flex; gap: 5px;">
                                            ${Array(codeLength).fill().map((_, j) => `
                                                <div style="width: 30px; height: 30px; border-radius: 50%;
                                                          background: ${attempt.guess[j] ? 
                                                            attempt.guess[j] === 'R' ? '#ff0000' :
                                                            attempt.guess[j] === 'G' ? '#00ff00' :
                                                            attempt.guess[j] === 'B' ? '#0000ff' : '#ffff00'
                                                          : 'rgba(255,255,255,0.1)'};
                                                          border: 1px solid var(--neon-blue);"></div>
                                            `).join('')}
                                        </div>
                                        <div style="display: flex; gap: 3px;">
                                            ${attempt.feedback.map(fb => `
                                                <div style="width: 10px; height: 10px; border-radius: 50%;
                                                          background: ${fb === 'B' ? 'black' : 'white'};
                                                          border: 1px solid rgba(255,255,255,0.3);"></div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="game-feedback" id="feedback">
                            ${attempts.length > 0 && attempts[attempts.length-1].feedback.every(f => f === 'B') ? 
                                '<span class="win">¬°Ganaste! C√≥digo descifrado</span>' :
                                attempts.length >= maxAttempts ? 
                                `<span class="lose">¬°Perdiste! El c√≥digo era: ${secretCode.join(' ')}</span>` :
                                'Haz clic en un color para seleccionarlo'}
                        </div>
                        
                        <div style="margin: 1rem 0;">
                            <div style="display: flex; gap: 10px; justify-content: center;">
                                ${colors.map(color => `
                                    <div class="game-button" style="width: 40px; height: 40px; border-radius: 50%;
                                            background: ${color === 'R' ? '#ff0000' :
                                                        color === 'G' ? '#00ff00' :
                                                        color === 'B' ? '#0000ff' : '#ffff00'};
                                            cursor: pointer;"
                                         onclick="this._gameData.addColor('${color}')">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="game-controls">
                            <button id="submitBtn" class="game-button">Enviar Intento</button>
                            <button id="newBtn" class="game-button">Nuevo Juego</button>
                        </div>
                    </div>
                `;
                
                // Asignar funciones
                window.tempMastermindGame = {
                    currentGuess: [],
                    addColor: function(color) {
                        if (this.currentGuess.length < codeLength) {
                            this.currentGuess.push(color);
                            renderGame();
                        }
                    },
                    submitGuess: function() {
                        if (this.currentGuess.length !== codeLength) {
                            alert('¬°Necesitas seleccionar 4 colores!');
                            return;
                        }
                        
                        const feedback = [];
                        const tempCode = [...secretCode];
                        const tempGuess = [...this.currentGuess];
                        
                        // Coincidencias exactas
                        for (let i = 0; i < codeLength; i++) {
                            if (tempGuess[i] === tempCode[i]) {
                                feedback.push('B');
                                tempGuess[i] = null;
                                tempCode[i] = null;
                            }
                        }
                        
                        // Colores correctos en posici√≥n incorrecta
                        for (let i = 0; i < codeLength; i++) {
                            if (tempGuess[i] !== null) {
                                const index = tempCode.indexOf(tempGuess[i]);
                                if (index !== -1) {
                                    feedback.push('W');
                                    tempCode[index] = null;
                                }
                            }
                        }
                        
                        attempts.push({
                            guess: [...this.currentGuess],
                            feedback: [...feedback]
                        });
                        
                        this.currentGuess = [];
                        renderGame();
                    }
                };
                
                document.querySelectorAll('[onclick*="addColor"]').forEach(el => {
                    el._gameData = window.tempMastermindGame;
                });
                
                document.getElementById('submitBtn').onclick = () => window.tempMastermindGame.submitGuess();
                document.getElementById('newBtn').onclick = () => {
                    generateCode();
                    window.tempMastermindGame.currentGuess = [];
                    renderGame();
                };
            }
            
            generateCode();
            window.tempMastermindGame = { currentGuess: [] };
            renderGame();
        }

        // JUEGO 13: Juego de la Vida (simplificado)
        function loadLifeGame(container) {
            const rows = 20;
            const cols = 20;
            let grid = Array(rows).fill().map(() => Array(cols).fill(0));
            let running = false;
            let intervalId = null;
            
            function initGrid() {
                grid = Array(rows).fill().map(() => 
                    Array(cols).fill().map(() => Math.random() > 0.7 ? 1 : 0)
                );
                renderGrid();
            }
            
            function renderGrid() {
                const cellSize = Math.min(20, Math.floor(400 / Math.max(rows, cols)));
                
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Juego de la Vida</h2>
                        <p class="game-instructions">Aut√≥mata celular de Conway. Las c√©lulas nacen o mueren seg√∫n sus vecinos.</p>
                        
                        <div class="game-board" style="
                            grid-template-columns: repeat(${cols}, ${cellSize}px);
                            grid-template-rows: repeat(${rows}, ${cellSize}px);
                            margin: 1rem auto;
                        ">
                            ${grid.map((row, y) => 
                                row.map((cell, x) => `
                                    <div class="game-cell" data-x="${x}" data-y="${y}"
                                         style="background: ${cell ? 'var(--neon-green)' : 'rgba(255,255,255,0.05)'};
                                                border: 1px solid rgba(0,255,255,0.1);
                                                cursor: pointer;"
                                         onclick="if(!this._gameData.running) this._gameData.toggleCell(${x}, ${y})">
                                    </div>
                                `).join('')
                            ).join('')}
                        </div>
                        
                        <div class="game-feedback" id="feedback">
                            ${running ? 'Ejecut√°ndose...' : 'Haz clic en celdas para activarlas/desactivarlas'}
                        </div>
                        
                        <div class="game-controls">
                            <button id="startBtn" class="game-button">
                                ${running ? 'Detener' : 'Iniciar'}
                            </button>
                            <button id="stepBtn" class="game-button">Paso</button>
                            <button id="resetBtn" class="game-button">Aleatorio</button>
                            <button id="clearBtn" class="game-button">Limpiar</button>
                        </div>
                    </div>
                `;
                
                // Asignar funciones
                window.tempLifeGame = {
                    running: running,
                    toggleCell: function(x, y) {
                        grid[y][x] = grid[y][x] ? 0 : 1;
                        renderGrid();
                    },
                    nextGeneration: function() {
                        const newGrid = Array(rows).fill().map(() => Array(cols).fill(0));
                        
                        for (let y = 0; y < rows; y++) {
                            for (let x = 0; x < cols; x++) {
                                const neighbors = countNeighbors(x, y);
                                
                                if (grid[y][x] === 1) {
                                    // C√©lula viva
                                    newGrid[y][x] = (neighbors === 2 || neighbors === 3) ? 1 : 0;
                                } else {
                                    // C√©lula muerta
                                    newGrid[y][x] = (neighbors === 3) ? 1 : 0;
                                }
                            }
                        }
                        
                        grid = newGrid;
                        renderGrid();
                    },
                    toggleRunning: function() {
                        running = !running;
                        this.running = running;
                        
                        if (running) {
                            intervalId = setInterval(this.nextGeneration, 200);
                        } else {
                            clearInterval(intervalId);
                        }
                        
                        renderGrid();
                    }
                };
                
                document.querySelectorAll('[onclick*="toggleCell"]').forEach(el => {
                    el._gameData = window.tempLifeGame;
                });
                
                document.getElementById('startBtn').onclick = () => window.tempLifeGame.toggleRunning();
                document.getElementById('stepBtn').onclick = () => window.tempLifeGame.nextGeneration();
                document.getElementById('resetBtn').onclick = initGrid;
                document.getElementById('clearBtn').onclick = () => {
                    grid = Array(rows).fill().map(() => Array(cols).fill(0));
                    renderGrid();
                };
            }
            
            function countNeighbors(x, y) {
                let count = 0;
                for (let dy = -1; dy <= 1; dy++) {
                    for (let dx = -1; dx <= 1; dx++) {
                        if (dx === 0 && dy === 0) continue;
                        const nx = (x + dx + cols) % cols;
                        const ny = (y + dy + rows) % rows;
                        count += grid[ny][nx];
                    }
                }
                return count;
            }
            
            initGrid();
        }

        // JUEGO 14: Battleship (CORREGIDO - funciona)
        function loadBattleshipGame(container) {
            const size = 5;
            let playerBoard = Array(size).fill().map(() => Array(size).fill(0));
            let enemyBoard = Array(size).fill().map(() => Array(size).fill(0));
            let gameOver = false;
            let playerTurn = true;
            
            // Barcos: [tama√±o]
            const ships = [3, 2, 2, 1];
            
            function placeShips(board) {
                const newBoard = Array(size).fill().map(() => Array(size).fill(0));
                
                for (const shipSize of ships) {
                    let placed = false;
                    let attempts = 0;
                    
                    while (!placed && attempts < 100) {
                        attempts++;
                        const horizontal = Math.random() > 0.5;
                        const x = Math.floor(Math.random() * (horizontal ? size - shipSize + 1 : size));
                        const y = Math.floor(Math.random() * (horizontal ? size : size - shipSize + 1));
                        
                        // Verificar si hay espacio
                        let canPlace = true;
                        for (let i = 0; i < shipSize; i++) {
                            const nx = horizontal ? x + i : x;
                            const ny = horizontal ? y : y + i;
                            
                            if (newBoard[ny][nx] !== 0) {
                                canPlace = false;
                                break;
                            }
                        }
                        
                        if (canPlace) {
                            // Colocar barco
                            for (let i = 0; i < shipSize; i++) {
                                const nx = horizontal ? x + i : x;
                                const ny = horizontal ? y : y + i;
                                newBoard[ny][nx] = 1;
                            }
                            placed = true;
                        }
                    }
                }
                
                return newBoard;
            }
            
            function renderBoards() {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Battleship</h2>
                        <p class="game-instructions">Hunde la flota enemiga. Turno: ${playerTurn ? 'Jugador' : 'Computadora'}</p>
                        
                        <div style="display: flex; flex-wrap: wrap; gap: 2rem; justify-content: center; margin: 1rem 0;">
                            <div>
                                <h3 style="color: var(--neon-blue); text-align: center;">Tu Flota</h3>
                                <div class="game-board" style="
                                    grid-template-columns: repeat(${size}, 35px);
                                    grid-template-rows: repeat(${size}, 35px);
                                    margin: 0.5rem auto;
                                ">
                                    ${playerBoard.map((row, y) => 
                                        row.map((cell, x) => `
                                            <div class="game-cell" 
                                                 style="background: ${cell === 2 ? 'var(--neon-pink)' : 
                                                           cell === 3 ? 'var(--neon-green)' :
                                                           cell === 1 ? 'var(--neon-blue)' :
                                                           'rgba(255,255,255,0.1)'};
                                                        font-size: 0.7rem;">
                                                ${cell === 2 ? 'üí•' : 
                                                 cell === 3 ? 'üí¶' : ''}
                                            </div>
                                        `).join('')
                                    ).join('')}
                                </div>
                            </div>
                            
                            <div>
                                <h3 style="color: var(--neon-pink); text-align: center;">Flota Enemiga</h3>
                                <div class="game-board" style="
                                    grid-template-columns: repeat(${size}, 35px);
                                    grid-template-rows: repeat(${size}, 35px);
                                    margin: 0.5rem auto;
                                ">
                                    ${enemyBoard.map((row, y) => 
                                        row.map((cell, x) => `
                                            <div class="game-cell" data-x="${x}" data-y="${y}"
                                                 style="background: rgba(255,255,255,0.1);
                                                        cursor: ${playerTurn && !gameOver ? 'pointer' : 'default'};
                                                        font-size: 0.7rem;">
                                                ${cell === 2 ? 'üí•' : 
                                                 cell === 3 ? 'üí¶' : ''}
                                            </div>
                                        `).join('')
                                    ).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="game-feedback" id="feedback">
                            ${gameOver ? '¬°Juego terminado!' : 
                              playerTurn ? 'Haz clic en el tablero enemigo para atacar' : 
                              'Turno de la computadora...'}
                        </div>
                        
                        <div class="game-controls">
                            <button id="newGameBtn" class="game-button">Nuevo Juego</button>
                        </div>
                    </div>
                `;
                
                // Event listeners para ataques del jugador
                if (playerTurn && !gameOver) {
                    document.querySelectorAll('[data-x]').forEach(cell => {
                        cell.onclick = () => {
                            const x = parseInt(cell.dataset.x);
                            const y = parseInt(cell.dataset.y);
                            
                            if (enemyBoard[y][x] === 0) { // Agua
                                enemyBoard[y][x] = 3;
                                playerTurn = false;
                                document.getElementById('feedback').innerHTML = 
                                    '<span style="color:var(--neon-blue)">¬°Agua!</span>';
                                setTimeout(computerTurn, 1000);
                            } else if (enemyBoard[y][x] === 1) { // Barco
                                enemyBoard[y][x] = 2;
                                document.getElementById('feedback').innerHTML = 
                                    '<span style="color:var(--neon-green)">¬°Impacto!</span>';
                                
                                // Verificar si gan√≥ el jugador
                                if (checkWin(enemyBoard)) {
                                    gameOver = true;
                                    document.getElementById('feedback').innerHTML = 
                                        '<span class="win">¬°Ganaste! Has hundido toda la flota enemiga</span>';
                                }
                            }
                            
                            renderBoards();
                        };
                    });
                }
                
                document.getElementById('newGameBtn').onclick = initGame;
            }
            
            function computerTurn() {
                if (gameOver) return;
                
                // Ataque aleatorio de la computadora
                let x, y;
                do {
                    x = Math.floor(Math.random() * size);
                    y = Math.floor(Math.random() * size);
                } while (playerBoard[y][x] >= 2);
                
                if (playerBoard[y][x] === 0) { // Agua
                    playerBoard[y][x] = 3;
                    playerTurn = true;
                    document.getElementById('feedback').innerHTML = 
                        '<span style="color:var(--neon-pink)">La computadora atac√≥: ¬°Agua!</span>';
                } else if (playerBoard[y][x] === 1) { // Barco
                    playerBoard[y][x] = 2;
                    document.getElementById('feedback').innerHTML = 
                        '<span class="lose">La computadora atac√≥: ¬°Impacto!</span>';
                    
                    // Verificar si gan√≥ la computadora
                    if (checkWin(playerBoard)) {
                        gameOver = true;
                        document.getElementById('feedback').innerHTML = 
                            '<span class="lose">¬°La computadora gan√≥! Ha hundido toda tu flota</span>';
                    } else {
                        setTimeout(computerTurn, 1000);
                    }
                }
                
                renderBoards();
            }
            
            function checkWin(board) {
                return !board.some(row => row.includes(1));
            }
            
            function initGame() {
                playerBoard = placeShips();
                enemyBoard = placeShips();
                gameOver = false;
                playerTurn = true;
                renderBoards();
            }
            
            initGame();
        }

        // JUEGO 15: Nonogramas (simplificado)
        function loadNonogramGame(container) {
            const size = 5;
            let puzzle = Array(size).fill().map(() => Array(size).fill(0));
            let solution = Array(size).fill().map(() => Array(size).fill(0));
            let playerGrid = Array(size).fill().map(() => Array(size).fill(0));
            
            function generatePuzzle() {
                // Generar soluci√≥n aleatoria
                solution = Array(size).fill().map(() => 
                    Array(size).fill().map(() => Math.random() > 0.5 ? 1 : 0)
                );
                
                // Generar pistas
                const rowClues = solution.map(row => {
                    const clues = [];
                    let count = 0;
                    for (let cell of row) {
                        if (cell === 1) {
                            count++;
                        } else if (count > 0) {
                            clues.push(count);
                            count = 0;
                        }
                    }
                    if (count > 0) clues.push(count);
                    return clues.length ? clues : [0];
                });
                
                const colClues = [];
                for (let j = 0; j < size; j++) {
                    const clues = [];
                    let count = 0;
                    for (let i = 0; i < size; i++) {
                        if (solution[i][j] === 1) {
                            count++;
                        } else if (count > 0) {
                            clues.push(count);
                            count = 0;
                        }
                    }
                    if (count > 0) clues.push(count);
                    colClues.push(clues.length ? clues : [0]);
                }
                
                playerGrid = Array(size).fill().map(() => Array(size).fill(0));
                
                renderGame(rowClues, colClues);
            }
            
            function renderGame(rowClues, colClues) {
                container.innerHTML = `
                    <div class="game-container">
                        <h2 class="game-title-large">Nonogramas</h2>
                        <p class="game-instructions">Rellena las celdas seg√∫n las pistas num√©ricas</p>
                        
                        <div style="display: flex; justify-content: center; margin: 1rem 0;">
                            <div style="display: grid; grid-template-columns: auto repeat(${size}, 40px);">
                                <!-- Esquina vac√≠a -->
                                <div style="width: 60px; height: 60px;"></div>
                                
                                <!-- Pistas de columnas -->
                                ${colClues.map(clues => `
                                    <div style="width: 40px; height: 60px; display: flex; flex-direction: column;
                                              align-items: center; justify-content: flex-end; padding-bottom: 5px;">
                                        ${clues.map(clue => `
                                            <div style="font-size: 0.8rem; color: var(--neon-blue);">${clue}</div>
                                        `).join('')}
                                    </div>
                                `).join('')}
                                
                                <!-- Filas -->
                                ${Array(size).fill().map((_, i) => `
                                    <div style="display: contents;">
                                        <!-- Pistas de fila -->
                                        <div style="width: 60px; height: 40px; display: flex; align-items: center;
                                                  justify-content: flex-end; padding-right: 10px;">
                                            ${rowClues[i].map(clue => `
                                                <div style="font-size: 0.8rem; color: var(--neon-blue); margin-left: 3px;">${clue}</div>
                                            `).join('')}
                                        </div>
                                        
                                        <!-- Celdas -->
                                        ${Array(size).fill().map((_, j) => `
                                            <div class="game-cell" data-x="${j}" data-y="${i}"
                                                 style="width: 40px; height: 40px;
                                                        background: ${playerGrid[i][j] === 1 ? 'var(--neon-blue)' : 
                                                                     playerGrid[i][j] === 2 ? 'rgba(255,255,255,0.2)' : 
                                                                     'rgba(255,255,255,0.05)'};
                                                        border: 1px solid rgba(0,255,255,0.3);
                                                        cursor: pointer;"
                                                 onclick="this._gameData.handleClick(${i}, ${j}, event)">
                                            </div>
                                        `).join('')}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="game-feedback" id="feedback">
                            Clic: Rellenar | Clic derecho: Marcar X
                        </div>
                        
                        <div class="game-controls">
                            <button id="checkBtn" class="game-button">Comprobar</button>
                            <button id="newBtn" class="game-button">Nuevo Nonograma</button>
                        </div>
                    </div>
                `;
                
                // Asignar funciones
                window.tempNonogramGame = {
                    handleClick: function(y, x, event) {
                        if (event.button === 0 || !event.button) { // Clic izquierdo
                            playerGrid[y][x] = playerGrid[y][x] === 1 ? 0 : 1;
                        } else if (event.button === 2) { // Clic derecho
                            event.preventDefault();
                            playerGrid[y][x] = playerGrid[y][x] === 2 ? 0 : 2;
                        }
                        renderGame(rowClues, colClues);
                    },
                    checkSolution: function() {
                        let correct = true;
                        for (let i = 0; i < size; i++) {
                            for (let j = 0; j < size; j++) {
                                if ((solution[i][j] === 1 && playerGrid[i][j] !== 1) ||
                                    (solution[i][j] === 0 && playerGrid[i][j] === 1)) {
                                    correct = false;
                                    break;
                                }
                            }
                        }
                        
                        document.getElementById('feedback').innerHTML = correct ? 
                            '<span class="win">¬°Nonograma completado correctamente!</span>' :
                            '<span class="lose">A√∫n hay errores</span>';
                    }
                };
                
                document.querySelectorAll('[onclick*="handleClick"]').forEach(el => {
                    el._gameData = window.tempNonogramGame;
                });
                
                document.getElementById('checkBtn').onclick = () => window.tempNonogramGame.checkSolution();
                document.getElementById('newBtn').onclick = generatePuzzle;
                
                // Prevenir men√∫ contextual
                document.querySelectorAll('.game-cell').forEach(cell => {
                    cell.oncontextmenu = (e) => e.preventDefault();
                });
            }
            
            generatePuzzle();
        }

        // ==================== FUNCIONES GLOBALES ====================
        function returnToMain() {
            domCache.mainPage.style.display = 'block';
            domCache.gamePage.style.display = 'none';
            state.currentGame = null;
            state.activeGameState = null;
            
            // Limpiar event listeners globales
            document.removeEventListener('keydown', handleKeyPress);
        }

        function toggleTheme() {
            const root = document.documentElement;
            const icon = document.querySelector('#themeToggle i');
            
            if (state.darkMode) {
                root.style.setProperty('--dark-bg', '#f0f0ff');
                root.style.setProperty('--card-bg', 'rgba(255, 255, 255, 0.95)');
                root.style.setProperty('--text-primary', '#111122');
                root.style.setProperty('--text-secondary', '#444466');
                root.style.setProperty('--grid-color', 'rgba(100, 100, 255, 0.1)');
                icon.className = 'fas fa-sun';
                state.darkMode = false;
            } else {
                root.style.setProperty('--dark-bg', '#0a0a1a');
                root.style.setProperty('--card-bg', 'rgba(16, 16, 32, 0.85)');
                root.style.setProperty('--text-primary', '#ffffff');
                root.style.setProperty('--text-secondary', '#ccccff');
                root.style.setProperty('--grid-color', 'rgba(0, 255, 255, 0.1)');
                icon.className = 'fas fa-moon';
                state.darkMode = true;
            }
        }

        // Funci√≥n auxiliar para teclado (usada en Laberinto)
        function handleKeyPress(e) {
            // Esta funci√≥n se asigna din√°micamente en loadMazeGame
        }

        window.returnToMain = returnToMain;
        
        // Optimizar redimensionamiento
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (state.currentGame) {
                    loadGameContent(state.currentGame);
                }
            }, 200);
        });
    </script>
</body>
</html>
